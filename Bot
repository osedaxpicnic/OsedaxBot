import os
import discord as dpy
from discord.ext import commands

intents = dpy.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix="!", intents=intents)

@bot.event
async def on_ready():
    print(f"âœ… ConnectÃ© comme {bot.user} (ID: {bot.user.id})")
    await bot.change_presence(activity=dpy.Game("ğŸŒŠ Festin d'os au fond des mers..."))

    # Recherche automatique du salon principal
    channel = None
    for guild in bot.guilds:
        for ch in guild.text_channels:
            if ch.name in ["gÃ©nÃ©ral", "discussion", "general"]:
                channel = ch
                break

    if channel:
        message = (
            "ğŸŒŠ **Osedax Assistant a Ã©mergÃ© des profondeurs.**\n\n"
            "Sous la pression des abysses, les os se disloquent, et les vers se mettent Ã  table.\n"
            "Le festin peut commencer.\n\n"
            "ğŸ¦´ **Commandes disponibles :**\n"
            "â€¢ `!ping` â†’ pour vÃ©rifier que le courant passe encore.\n"
            "â€¢ `!aide` â†’ pour explorer les fonctions disponibles.\n"
            "â€¢ `!fab` â†’ pour convoquer les profondeurs de *Flesh and Blood*.\n\n"
            "ğŸš *Un pique-nique dâ€™os, Ã  mille brasses sous la surface.*\n"
            "#OsedaxPicnic"
        )
        await channel.send(message)
    else:
        print("âš ï¸ Aucun salon 'gÃ©nÃ©ral' trouvÃ© pour envoyer le message dâ€™accueil.")
@bot.event
async def on_ready():
    print(f"âœ… ConnectÃ© comme {bot.user} (ID: {bot.user.id})")
    await bot.change_presence(activity=dpy.Game("ğŸŒŠ Festin d'os au fond des mers..."))

    # Recherche automatique du salon principal
    channel = None
    for guild in bot.guilds:
        for ch in guild.text_channels:
            if ch.name in ["gÃ©nÃ©ral", "discussion", "general"]:
                channel = ch
                break

    if channel:
        message = (
            "ğŸŒŠ **Osedax Assistant a Ã©mergÃ© des profondeurs.**\n\n"
            "Sous la pression des abysses, les os se disloquent, et les vers se mettent Ã  table.\n"
            "Le festin peut commencer.\n\n"
            "ğŸ¦´ **Commandes disponibles :**\n"
            "â€¢ `!ping` â†’ pour vÃ©rifier que le courant passe encore.\n"
            "â€¢ `!aide` â†’ pour explorer les fonctions disponibles.\n"
            "â€¢ `!fab` â†’ pour convoquer les profondeurs de *Flesh and Blood*.\n\n"
            "ğŸš *Un pique-nique dâ€™os, Ã  mille brasses sous la surface.*\n"
            "#OsedaxPicnic"
        )
        await channel.send(message)
    else:
        print("âš ï¸ Aucun salon 'gÃ©nÃ©ral' trouvÃ© pour envoyer le message dâ€™accueil.")


@bot.command()
async def ping(ctx):
    await ctx.send("Pong ! ğŸ“")

TOKEN = os.getenv("DISCORD_TOKEN", "").strip()
if not TOKEN:
    raise RuntimeError("DISCORD_TOKEN manquant (variable d'environnement).")

bot.run(TOKEN)
